import { NextRequest, NextResponse } from 'next/server';import Stripe from 'stripe';const stripe=new Stripe(process.env.STRIPE_SECRET_KEY||'',{apiVersion:'2024-06-20' as any});export async function POST(req:NextRequest){const ct=req.headers.get('content-type')||'';let priceId:string|null=null;if(ct.includes('application/json')){const body=await req.json();priceId=body.priceId;}else{const form=await req.formData();priceId=form.get('priceId') as string|null;}if(!priceId)return NextResponse.json({error:'Missing priceId'},{status:400});const session=await stripe.checkout.sessions.create({mode:'subscription',line_items:[{price:priceId,quantity:1}],success_url:(process.env.SITE_URL||'http://localhost:3000')+'/dashboard?checkout=success',cancel_url:(process.env.SITE_URL||'http://localhost:3000')+'/pricing',allow_promotion_codes:true});return NextResponse.json({url:session.url});}